<html>
    <head>
        <title>CircleWallpaper</title>
    </head>
    <body>
        <style>
            table, th, td{
                text-align: center;
                padding: 10px;
            }
        </style>

        <table>
            <tr>
                <td>Starting Size: <input type="text" id="startingSizeText" value="6"></td>
                <td>Ending Size: <input type="text" id="endingSizeText" value="8"></td>
            </tr>
            <tr>
                <td>Variance: <input type="text" id="varianceText" value="64"></td>
            </tr>
            <tr>
                <td>Generate instantly: <input type="radio" name="generationType" id="instantlyRadio" checked></td>
                <td>Generate gradually: <input type="radio" name="generationType" id="graduallyRadio"></td>
            </tr>
            <tr>
                <td>Width: <input type="text" id="widthText" value="1"></td>
                <td>Height: <input type="text" id="heightText" value="1"></td>
            </tr>
            <tr>
                <td><input type="button" onClick="submit()" value="Generate Wallpaper"></td>
                <td><input type="button" onClick="reset()" value="Reset"></td>
            </tr>
        </table>

        <canvas id="canv" width="1" height="1" style="border:1px solid #d3d3d3;">Canvas failed to load. Does your browser support HTML5 and Javascript?</canvas>

        <script>
            document.getElementById('widthText').value = window.innerWidth;
            document.getElementById('heightText').value = window.innerHeight;
            var canv = document.getElementById('canv');
            var steps = 0;
            ctx = canv.getContext("2d");

            //var color0 = "#" + Math.random().toString(16).slice(2, 8);
            //var color1 = "#" + color0.slice(3, 5) + color0.slice(1, 3) + color0.slice(5, 7);
            //var color2 = "#" + color0.slice(3, 5) + color0.slice(5, 7) + color0.slice(1, 3);
            //var color3 = "#" + color0.slice(5, 7) + color0.slice(3, 5) + color0.slice(1, 3);
            //var color4 = "#" + color0.slice(5, 7) + color0.slice(1, 3) + color0.slice(3, 5);
            //var color5 = "#" + color0.slice(1, 3) + color0.slice(5, 7) + color0.slice(3, 5);
            //var color6 = "#" + Math.random().toString(16).slice(2, 8);
            //var colors = [color0, color1, color2, color3, color4, color5, color6];

            function reset(){
                document.getElementById("startingSizeText").value="6";
                document.getElementById("endingSizeText").value="8";
                document.getElementById("varianceText").value="64";
                document.getElementById("instantlyRadio").checked=true;
                document.getElementById('widthText').value = window.innerWidth;
                document.getElementById('heightText').value = window.innerHeight;
            }

            //gets the red of a color
            function getRed(color){
                return(color.slice(1,3));
            }
            //gets the green of a color
            function getGreen(color){
                return(color.slice(3,5));
            }
            //gets the blue of a color
            function getBlue(color){
                return(color.slice(5,7));
            }

            function rgbToHsv(color){
                r = getRed(color);
                g = getGreen(color);
                b = getBlue(color);
                var min = Math.min(r, Math.min(g, b)); //smallest value out of red, green, and blue
                var max = Math.max(r, Math.max(g, b)); //largest value out of red, green, and blue

                if(min == max) return([0, 0, min]); //if the color is white, black, or grey

            }

            //produces a random color
            function generateColor(){
                return("#" + Math.random().toString(16).slice(2, 8)); 
            }

            //flips the red and blue values of a color
            function flipRedBlue(color){
                return("#" + getBlue(color) + getGreen(color) + getRed(color));
            }

            //produces a color where the red, green, and blue can change up to +/- change
            function varyColor(color, variance){
                return("#" + ((parseInt(getRed(color), 16)-variance)+(Math.floor(Math.random()*variance*2))).toString(16) + ((parseInt(getGreen(color), 16)-variance)+(Math.floor(Math.random()*variance*2))).toString(16)+ ((parseInt(getBlue(color), 16)-variance)+(Math.floor(Math.random()*variance*2))).toString(16)); 
            }

            //determine the average color of an array of colors
            function averageColor(colors){
                totalRed=0;
                totalGreen=0;
                totalBlue=0;
                for(i=0; i<colors.length; i++){
                    totalRed += parseInt(getRed(colors[i]), 16);
                    totalGreen += parseInt(getGreen(colors[i]), 16);
                    totalBlue += parseInt(getBlue(colors[i]), 16);
                }
                return("#" + Math.round(totalRed/colors.length).toString(16) + Math.round(totalGreen/colors.length).toString(16) + Math.round(totalBlue/colors.length).toString(16));
            }


            function submit(){
                width = parseInt(document.getElementById('widthText').value);
                height = parseInt(document.getElementById('heightText').value);
                canv.width = width;
                canv.height = height;

                var startingSize=parseInt(document.getElementById('startingSizeText').value);
                var endingSize=parseInt(document.getElementById('endingSizeText').value);
                var variance=parseInt(document.getElementById('varianceText').value);
                var generationType=document.getElementById('instantlyRadio').checked;

                var color0 = generateColor();
                var color1 = flipRedBlue(color0)
                var color2 = varyColor(color1, variance);
                var color3 = flipRedBlue(color2);
                var color4 = varyColor(color3, variance);
                var color5 = flipRedBlue(color4);
                var color6 = varyColor(color5, variance);
                var colors = [color0, color1, color2, color3, color4, color5, color6];

                average = averageColor([averageColor(colors), "#ffffff"]);
                ctx.fillStyle = average;
                ctx.fillRect(0, 0, width, height);

                if(generationType){
                    generateInstantly(colors, startingSize, endingSize);
                }else{

                    var size=startingSize;
                    var x=size;
                    var y=size;
                    var graduallyGenerating = setInterval("generateGradually(colors)", 1);
                }
            }

            function generateInstantly(colors, startingSize, endingSize){
                for(var size=startingSize; size<endingSize+1; size++){
                    for(var y=size; y<height; y+=size*2){
                        for(var x=size; x<width; x+=size*2){
                            ctx.beginPath();
                            ctx.arc(x, y, size, 0, 2*Math.PI);
                            if(steps<6){
                                steps++;
                            }else{
                                steps=0;
                            }
                            ctx.strokeStyle=colors[steps];
                            ctx.fillStyle=colors[steps];
                            ctx.stroke();
                        }
                    }
                }
            }

            function generateGradually(colors){
                ctx.beginPath();
                if(steps<6) steps++;
                else steps=0;
                ctx.strokeStyle=colors[steps];
                ctx.arc(x, y, size, 0, 2*Math.PI);
                ctx.stroke();
                
                if(x<width){
                    x+=size;
                }else{
                    x=0;
                    if(y<height){
                        y+=size;
                    }else{
                        y=0;
                        if(size<endingSize+1){
                            size++;
                        }else{
                            alert("Wallpaper Generation Complete!");
                            clearInterval(graduallyGenerating);
                        }
                    }
                }
            }

        </script>
    </body>
</html>
